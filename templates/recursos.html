<!doctype html>
<html lang="{{ lang or 'ca' }}">

<head>
  <meta charset="utf-8">
  <link rel="icon"
    href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-pencil' viewBox='0 0 16 16'%3E%3Cpath d='M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z'/%3E%3C/svg%3E">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ content.recursos.title if content and content.recursos is defined else "Recursos" }}</title>

  <!-- reutilitzem els mateixos estils que index.html -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.3.2/css/flag-icons.min.css" />
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <link rel="stylesheet" href="/static/css/w3.css">
  <link rel="stylesheet" href="/static/css/style.css">

  <style>
    /* header artístic per Recursos */
    .recursos-hero {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 1.5rem 0;
      width: 100%;
    }

    .recursos-hero h2 {
      margin: 0;
      font-family: 'Bitcount Grid Double', sans-serif;
      letter-spacing: 0.6px;
      text-align: center;
    }

    .recursos-sub {
      color: #666;
      font-size: 0.95rem;
      margin-top: 4px;
      text-align: center;
    }

    /* centrar títols de targetes */
    .w3-card-4 .w3-container h3 {
      text-align: center;
    }

    /* botó Pujar: icona a l'esquerra del text */
    .upload-cta {
      display: inline-flex;
      flex-direction: row;
      /* fila en lloc de columna */
      align-items: center;
      justify-content: center;
      gap: 8px;
      /* espai entre icona i text */
      padding: 8px 12px;
      border-radius: 6px;
      text-decoration: none;
    }

    .upload-cta .icon {
      width: 28px;
      height: 28px;
      border-radius: 6px;
      background: linear-gradient(135deg, #00b4d8, #0077b6);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.12);
      font-size: 14px;
    }

    .upload-cta .label {
      font-weight: 600;
      color: #fff;
    }

    /* Estils per eliminar recurs */
    .recurso-card {
      position: relative;
      cursor: pointer;
    }

    .delete-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      background: #f44336;
      color: white;
      border: none;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      display: none;
      /* amagat per defecte */
      align-items: center;
      justify-content: center;
      font-size: 20px;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
      z-index: 10;
      transition: transform 0.2s;
    }

    .delete-btn:hover {
      transform: scale(1.1);
      background: #d32f2f;
    }

    .delete-btn.active,
    .edit-btn.active {
      display: flex;
    }

    .edit-btn {
      position: absolute;
      top: 8px;
      right: 48px;
      /* al costat de la creu */
      background: #ffc107;
      color: #333;
      border: none;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      display: none;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
      z-index: 10;
      transition: transform 0.2s;
    }

    .edit-btn:hover {
      transform: scale(1.1);
      background: #ffca28;
    }

    /* Estils per la barra d'accions central */
    .action-toolbar {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1rem;
      padding: 1rem;
      margin-bottom: 2rem;
    }

    .action-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.8rem 1.5rem;
      font-size: 1.1rem;
      border-radius: 8px;
      text-decoration: none;
      transition: transform 0.2s, box-shadow 0.2s;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      border: none;
      cursor: pointer;
    }

    .action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }
  </style>
</head>

<body class="w3-light-grey">
  <header class="w3-container w3-white w3-padding">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <a href="{{ url_for('home', lang_code=content.lang_code if content and content.lang_code is defined else 'ca') }}"
        class="w3-button w3-border w3-round">
        <i class="bi bi-house-door-fill" style="margin-right:0.5rem;"></i> {{ content.recursos.btn_home if content and
        content.recursos is defined else "Inici" }}
      </a>

      {% if user.username %}
      <div>
        <span class="w3-tag w3-green w3-round"> {{ user.username }} </span>
        <a class="w3-button w3-border w3-round" href="{{ url_for('recursos.recursos_logout') }}">{{
          content.recursos.btn_logout if content
          and content.recursos is defined else "Logout" }}</a>
      </div>
      {% else %}
      <a class="w3-button w3-blue w3-round" href="{{ url_for('recursos.recursos_login') }}">{{
        content.recursos.btn_login if content and
        content.recursos is defined else "Identifica't" }}</a>
      {% endif %}
    </div>

    <div class="recursos-hero">
      <!-- icona descriptiva + títol -->
      <div class="w3-center">
        <h2>{{ content.recursos.title if content and content.recursos is defined else "Recursos didàctics" }}
          <i class="bi bi-journal-bookmark" style="font-size:1.2rem; color:#0d6efd; margin-left:0.6rem;"></i>
        </h2>
        <div class="recursos-sub">{{ content.recursos.hero_sub if content and content.recursos is defined else
          "Recursos, documents i enllaços per a l'aprenentatge — accessible per tothom; pujar requereix identificació."
          }}</div>
      </div>
    </div>

    <!-- ACTION TOOLBAR -->
    <div class="action-toolbar">
      <a href="{{ url_for('recursos.pissarra_list') }}" class="action-btn w3-indigo">
        <i class="bi bi-easel"></i>
        {{ content.recursos.pissarra.title if content and content.recursos.pissarra is defined else "Pissarres Digitals"
        }}
      </a>

      {% if user.username %}
      <a href="{{ url_for('recursos.recursos_upload') }}" class="action-btn w3-green">
        <i class="bi bi-cloud-arrow-up"></i>
        {{ content.recursos.btn_upload if content and content.recursos is defined else "Pujar Recurs" }}
      </a>

      {% if user.role == "admin" %}
      <button onclick="document.getElementById('newUserModal').style.display='block'" class="action-btn w3-dark-grey">
        <i class="bi bi-person-plus"></i> Admin: Usuaris
      </button>
      {% endif %}

      {% endif %}
    </div>

  </header>

  <main class="w3-container w3-margin-top">
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, msg in messages %}
    <div
      class="w3-panel w3-pale-{{ 'green' if category == 'success' else 'red' if category == 'danger' else 'yellow' }}">
      {{ msg }}
    </div>
    {% endfor %}
    {% endif %}
    {% endwith %}

    <div class="w3-row-padding">
      {% for r in recursos %}
      <div class="w3-third w3-margin-bottom">
        <div class="w3-card-4 recurso-card" onclick="toggleDelete(this)">
          {% if user.username %}
          <button class="delete-btn" onclick="confirmDelete(event, {{ r.id }})">
            <i class="bi bi-x"></i>
          </button>
          <a class="edit-btn" href="{{ url_for('recursos.recursos_edit', recurso_id=r.id) }}"
            onclick="event.stopPropagation()">
            <i class="bi bi-pencil-fill"></i>
          </a>
          {% endif %}
          <div class="w3-container w3-white">
            <h3>{{ r.title }}</h3>
            <p class="w3-small">{{ r.description }}</p>
            <p class="w3-tiny">
              {{ content.recursos.uploader if content and content.recursos is defined else "Pujat per" }}:
              {{ r.uploader.username if r.uploader else 'desconegut' }} · {{ r.uploaded_at.strftime('%Y-%m-%d %H:%M') }}
              {% if r.last_editor %}
              <br>
              {{ content.recursos.last_editor if content and content.recursos is defined else "Editat per" }}:
              {{ r.last_editor.username }} · {{ r.updated_at.strftime('%Y-%m-%d %H:%M') if r.updated_at else '' }}
              {% endif %}
            </p>
          </div>
          <div class="w3-container w3-center w3-padding">
            {% if r.file_type == 'img' and r.filename %}
            <img src="{{ url_for('static', filename='recursos/' ~ r.filename) }}" alt="{{ r.title }}"
              style="max-width:100%; height:180px; object-fit:cover;">
            {% elif r.file_type == 'pdf' %}
            {% if r.url %}
            <a class="w3-button w3-blue" href="{{ r.url }}" target="_blank"><i class="bi bi-file-earmark-pdf"></i> Veure
              PDF</a>
            {% elif r.filename %}
            <a class="w3-button w3-blue" href="{{ url_for('static', filename='recursos/' ~ r.filename) }}"
              target="_blank"><i class="bi bi-file-earmark-pdf"></i> Veure PDF</a>
            {% endif %}
            {% elif r.file_type == 'link' and r.url %}
            <a class="w3-button w3-indigo" href="{{ r.url }}" target="_blank"><i class="bi bi-box-arrow-up-right"></i>
              Obre enllaç</a>
            {% elif r.filename %}
            <a class="w3-button w3-grey" href="{{ url_for('static', filename='recursos/' ~ r.filename) }}"
              target="_blank"><i class="bi bi-download"></i> Descarregar</a>
            {% endif %}
          </div>
        </div>
      </div>
      {% else %}
      <p>{{ content.recursos.no_resources if content and content.recursos is defined else "No hi ha recursos publicats."
        }}</p>
      {% endfor %}
    </div>
  </main>

  <script>
    function toggleDelete(card) {
      const btnD = card.querySelector('.delete-btn');
      const btnE = card.querySelector('.edit-btn');
      if (btnD) btnD.classList.toggle('active');
      if (btnE) btnE.classList.toggle('active');
    }

    function confirmDelete(event, id) {
      event.stopPropagation(); // evitar que el clic al botó tanqui el botó
      const msg = "{{ content.recursos.confirm_delete if content and content.recursos is defined else 'Segur que voleu eliminar el recurs?' }}";
      if (confirm(msg)) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = "/recursos/delete/" + id;
        document.body.appendChild(form);
        form.submit();
      }
    }
  </script>

  <!-- Modal Crear Usuari (Admin) -->
  {% if user.role == 'admin' %}
  <div id="newUserModal" class="w3-modal">
    <div class="w3-modal-content w3-card-4" style="max-width:500px">
      <header class="w3-container w3-dark-grey">
        <span onclick="document.getElementById('newUserModal').style.display='none'"
          class="w3-button w3-display-topright">&times;</span>
        <h2>Crear Nou Usuari</h2>
      </header>
      <form class="w3-container w3-padding" action="{{ url_for('recursos.user_create') }}" method="POST">
        <label>Nom d'usuari</label>
        <input class="w3-input w3-border" type="text" name="username" required>
        <br>
        <label>Contrasenya</label>
        <input class="w3-input w3-border" type="password" name="password" required>
        <br>
        <label>Rol</label>
        <select class="w3-select w3-border" name="role">
          <option value="user">Usuari</option>
          <option value="admin">Administrador</option>
        </select>
        <div class="w3-margin-top w3-center">
          <button class="w3-button w3-dark-grey" type="submit">Crear Usuari</button>
        </div>
      </form>
    </div>
  </div>
  {% endif %}

  <script> const pagina_nom = "recursos"; </script>
  <script src="/static/js/registre_clics.js"></script>
</body>

</html>